<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <!--
        This is what the embed iframe src links to. It doesn't need to communicate with the parent page, only fill the available space and look for #? parameters
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="uv.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>

    <script type="text/javascript" src="umd/UV.js"></script>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
            var uv;
            let urlAdapter = new UV.IIIFURLAdapter();
            var formattedLocales;
            var locales = urlAdapter.get('locales', '');
            if (locales) {
                var names = locales.split(',');
                formattedLocales = [];
                for (var i in names) {
                    var nameparts = String(names[i]).split(':');
                    formattedLocales[i] = { name: nameparts[0], label: nameparts[1] };
                }
            } else {
                formattedLocales = [
                    {
                        name: 'en-GB'
                    }
                ]
            }

            const data = urlAdapter.getInitialData();
            uv = UV.init('uv', data);

            uv.on("configure", function ({ config, cb }) {
                  cb(
                    new Promise(function (resolve) {
                      fetch("uv-config.json").then(function (response) {
                        resolve(response.json());
                      });
                    })
                  );
                });

            uv.on('canvasIndexChanged', function (event) {
                window.parent.postMessage(event, "*")
            })
        }, false);
    </script>
</head>

<body>

    <div id="uv" class="uv"></div>

    <script>
        $(function () {
            var $UV = $('#uv');
            function resize() {
                var windowWidth = window.innerWidth;
                var windowHeight = window.innerHeight;
                $UV.width(windowWidth);
                $UV.height(windowHeight);
            }
            $(window).on('resize', function () {
                resize();
            });
            resize();
        });
    </script>


</body>

</html>
