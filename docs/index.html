<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.25
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<p><a href="https://circleci.com/gh/yalelibrary/yul-dc-blacklight/tree/master"><img src="https://circleci.com/gh/yalelibrary/yul-dc-blacklight/tree/master.svg?style=svg"></a> <img src="https://github.com/yalelibrary/yul-dc-blacklight/workflows/Docker%20Image%20CI/badge.svg"></p>

<h1 id="label-Yale+Digital+Library+Discovery+Application">Yale Digital Library Discovery Application</h1>

<p>This is one of the microservices applications that form the Yale digital library.</p>

<h2 id="label-Development+guide">Development guide</h2>

<h3 id="label-Prerequisites">Prerequisites</h3>
<ul><li>
<p>Download <a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a> and log in</p>
</li></ul>

<h3 id="label-Docker+Development+Setup">Docker Development Setup</h3>
<ul><li>
<p>Checkout the project  <code>bash   git clone https://github.com/yalelibrary/yul-dc-blacklight.git   cd yul-dc-blacklight   docker-compose pull blacklight </code></p>
</li></ul>

<h3 id="label-Starting+the+app">Starting the app</h3>
<ul><li>
<p>Start the blacklight service and it&#39;s dependencies  This command reads the docker-compose.yml file and starts all the containers described by it  including blacklight, solr, the manifest service, the management app, and a iiif image server.</p>
</li></ul>

<p><code>bash   docker-compose up blacklight </code></p>

<p>Output from the blackight container will display in your terminal window with Solr, Cantaloupe (IIIF),  and Manifest services running in the background</p>
<ul><li>
<p>Access the blacklight app at <code>http://localhost:3000</code></p>
</li><li>
<p>Access the solr instance at <code>http://localhost:8983</code></p>
</li><li>
<p>Access the image instance at <code>http://localhost:8182</code></p>
</li><li>
<p>Access the manifests instance at <code>http://localhost</code></p>
</li></ul>

<h3 id="label-Accessing+the+blacklight+container">Accessing the blacklight container</h3>
<ul><li>
<p>In a separate terminal window or tab, run:</p>
</li></ul>

<p><code>bash   docker-compose exec blacklight bash </code></p>
<ul><li>
<p>You will need to be inside the container to:</p>
</li><li>
<p>Run migrations</p>
</li><li>
<p>Access the seed file</p>
</li><li>
<p>Access the rails console for debugging</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_exec'>exec</span> <span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_c'>c</span>
</code></pre>
</li><li>
<p>Run rubocop</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_exec'>exec</span> <span class='id identifier rubyid_rubocop'>rubocop</span> <span class='op'>-</span><span class='id identifier rubyid_a'>a</span>
</code></pre>
</li><li>
<p>Run rspec</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_exec'>exec</span> <span class='id identifier rubyid_rspec'>rspec</span>
</code></pre>
</li><li>
<p>Rebuild the code documentation</p>

<pre class="code ruby"><code class="ruby">bundle exec rake yale:docs:blacklight
</code></pre>
</li></ul>

<h3 id="label-Indexing+data">Indexing data</h3>
<ul><li>
<p>First, connect to the running management application:</p>
</li><li>
<p><a href="http://localhost:3001/management">localhost:3001/management</a>/</p>
</li><li>
<p>Second, pull up <a href="http://0.0.0.0:8983">0.0.0.0:8983</a> in your browser</p>
</li><li>
<p>Connect to the blacklight-core and execute a query to confirm no data present</p>
</li><li>
<p>Then, in the running management application(:3001), click the button &#39;Index Ladybird Records to Solr&#39;</p>
</li><li>
<p>When the message appears above the buttons the data has been indexed</p>
</li><li>
<p>Visit :8983 and run the same query again and confirm data is present</p>
</li><li>
<p>Connect to the running blacklight app at localhost:3000</p>
</li></ul>

<h2 id="label-Pulling+or+Building+Docker+Images">Pulling or Building Docker Images</h2>

<p>Any time you pull a branch with a Gemfile change you need to pull or build a new Docker image. If you change the Dockerfile, you  need to build a new Docker image. If you change a file in ./ops you need to build a new Docker image. These are the primary  times in which you need to pull or build.</p>

<h2 id="label-When+Installing+a+New+Gem">When Installing a New Gem</h2>

<p>For the most part images are created and maintained by the CI process. However, if you change the Gemfile you need  to take a few extra steps. Make sure the application is running before you make your Gemfile change. Once you&#39;ve  updated the Gemfile, inside the container, run <code>bundle &amp;&amp; nginx -s reload</code>. The next time you stop your running containers  you need to rebuild.</p>

<h2 id="label-Environment+Variables+for+Development">Environment Variables for Development</h2>

<p>Create .env.development to override anything in .env. The following values must be overridden.</p>

<pre class="code ruby"><code class="ruby">SOLR_URL=http://solr:8983/solr/blacklight-core
POSTGRES_HOST=db
IIIF_MANIFESTS_BASE_URL=http://localhost/manifests/
</code></pre>

<h2 id="label-HTTP+password+protection">HTTP password protection</h2>

<p>In order to prevent search engine crawling of the system before it&#39;s ready to launch, we use HTTP password protection. This is set via environment variables. Set <code>HTTP_PASSWORD_PROTECT=&#39;true&#39;</code> to enable this feature. Set <code>HTTP_PASSWORD_PROTECT=&#39;false&#39;</code> to disable this feature. Set the login and password via environment variables <code>HTTP_USERNAME</code> and <code>HTTP_PASSWORD</code></p>

<h2 id="label-Releasing+a+new+version">Releasing a new version</h2>
<ol><li>
<p>Decide on a new version number. We use <a href="https://semver.org/">semantic versioning</a>.</p>
</li><li>
<p>Update the version number in <code>.github_changelog_generator</code></p>
</li><li>
<p>github_changelog_generator –user yalelibrary –project yul-dc-blacklight –token $YOUR_GITHUB_TOKEN</p>
</li><li>
<p>Commit and merge the changes you just made.</p>
</li><li>
<p>Once those changes are merged to the <code>master</code> branch, in the github web UI go to <code>Releases</code> and tag a new release with the right version number. Paste in the release notes for this version from the changelog you generated. In the release notes, split out <code>Features</code>, <code>Bug Fixes</code>, and <code>Other</code></p>
</li><li>
<p>Once the CI build has completed for <code>master</code>, tag and push a docker hub image with the same release number:</p>
</li></ol>

<p><code>   docker pull yalelibraryit/dc-blacklight:f93089f70e18d6c6d77ee1a6b3b4866b6d284078 &lt;-- the tag created by circleci   docker tag yalelibraryit/dc-blacklight:f93089f70e18d6c6d77ee1a6b3b4866b6d284078 yalelibraryit/dc-blacklight:v1.2.1 &lt;-- the new, semantically versioned tag   docker push yalelibraryit/dc-blacklight:v1.2.1 &lt;-- now our semantically versioned tag will be available from docker hub </code></p>
<ol><li>
<p>Update <code>yul-dc-camerata</code> with the new version of blacklight and submit a PR.</p>
</li></ol>

<h1 id="label-Using+a+New+Release+of+the+Management+App">Using a New Release of the Management App</h1>
<ol><li>
<p>Go to Management app on Github and check the latest release number</p>
</li><li>
<p>Edit your .env file to match the Management version to the latest release number</p>
</li><li>
<p>Run <code>docker-compose up</code></p>
</li></ol>
</div></div>

      <div id="footer">
  Generated on Wed Jun 17 19:07:57 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.6.6).
</div>

    </div>
  </body>
</html>